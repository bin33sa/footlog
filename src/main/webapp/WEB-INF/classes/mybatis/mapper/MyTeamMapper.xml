<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fl.mapper.MyTeamMapper">

	<select id="listMyTeam" parameterType="Long" resultType="com.fl.model.TeamDTO">
	    SELECT t.team_code, t.team_name, t.emblem_image
	    FROM team t
	    JOIN member_team tm ON t.team_code = tm.team_code
	    WHERE tm.member_code = #{member_code}
	    ORDER BY t.team_name
	</select>

	<select id="readTeamInfo" parameterType="Long" resultType="com.fl.model.TeamDTO">
	    SELECT 
	        team_code, 
	        team_name, 
	        team_url,
	        contact_number,
	        region, 
	        description,      created_at,
	        emblem_image,
	        intro_video_url,
	        member_count
	    FROM team
	    WHERE team_code = #{team_code}
	</select>
	
	<select id="listHomeTeamBoard" parameterType="long" resultType="com.fl.model.TeamBoardDTO">
        SELECT b.board_team_code, b.title, 
               m.member_name, 
               TO_CHAR(b.created_at, 'MM.DD') as created_at, -- 메인 화면용 짧은 날짜
               b.hit_count AS view_count,
               b.category AS notice
        FROM board_team b
        JOIN member m ON b.member_code = m.member_code 
        WHERE b.team_code = #{team_code}
        ORDER BY b.category DESC, b.board_team_code DESC
        FETCH FIRST 5 ROWS ONLY
    </select>
	
	<select id="readMyTeamStatus" parameterType="map" resultType="com.fl.model.TeamMemberDTO">
	    SELECT 
	        team_code, 
	        member_code, 
	        role_level, 
	        position, 
	        back_number, 
	        profile_image,
	        reg_date AS join_date
	    FROM member_team
	    WHERE team_code = #{team_code} 
	      AND member_code = #{member_code}
	</select>
	
	<update id="updateTeamMember" parameterType="com.fl.model.TeamMemberDTO">
		UPDATE member_team
		SET profile_image = #{profile_image}
		WHERE team_code = #{team_code} 
		  AND member_code = #{member_code}
	</update>
	
	<update id="updateTeamInfo" parameterType="com.fl.model.TeamDTO">
	    UPDATE team
	    SET 
	        team_name = #{team_name},
	        description = #{description},
	        region = #{region},
	        emblem_image = #{emblem_image}
	        WHERE team_code = #{team_code}
	</update>

	<delete id="deleteMyTeamHistory" parameterType="map">
	    DELETE FROM member_team 
	    WHERE team_code = #{team_code} AND member_code = #{member_code}
	</delete>
	
	<update id="updateTeamMemberCountDown" parameterType="Long">
		UPDATE team SET member_count = member_count - 1 WHERE team_code = #{team_code}
	</update>
	
	<update id="updateTeamMemberCountUp" parameterType="Long">
		UPDATE team SET member_count = member_count + 1 WHERE team_code = #{team_code}
	</update>


	<select id="listTeamMember" parameterType="map" resultType="com.fl.model.TeamMemberDTO">
	    SELECT * FROM (
	        SELECT ROWNUM rnum, tb.* FROM (
	            SELECT 
	                tm.member_code, 
	                m.member_name,  
	                m.member_id,    
	                tm.role_level,
	                tm.position,
	                tm.back_number,
	                tm.profile_image,  TO_CHAR(tm.reg_date, 'YYYY-MM-DD') AS join_date
	                
	            FROM member_team tm
	            JOIN member m ON tm.member_code = m.member_code
	            WHERE tm.team_code = #{team_code} 
	            
	            <if test="keyword != null and keyword != ''">
	                AND (m.member_name LIKE '%' || #{keyword} || '%')
	            </if>
	            ORDER BY tm.role_level DESC, m.member_name ASC
	        ) tb WHERE ROWNUM &lt;= #{end}
	    ) WHERE rnum &gt;= #{start}
	</select>
	
	<select id="dataCountTeamMember" parameterType="map" resultType="Integer">
		SELECT COUNT(*)
		FROM team_member tm
		JOIN member m ON tm.member_code = m.member_code
		WHERE tm.team_code = #{team_code} AND tm.status = 1
		<if test="keyword != null and keyword != ''">
			AND (m.user_name LIKE '%' || #{keyword} || '%')
		</if>
	</select>

	<update id="updateMemberRole" parameterType="map">
	    UPDATE member_team
	    <set>
	        <if test="role_level != null and role_level != ''">
	            role_level = #{role_level},
	        </if>
	        <if test="position != null and position != ''">
	            position = #{position},
	        </if>
	        <if test="back_number != null and back_number != ''">
	            back_number = #{back_number},
	        </if>
	    </set>
	    WHERE team_code = #{team_code} 
	      AND member_code = #{member_code}
	</update>

	<delete id="deleteTeamMember" parameterType="map">
	    DELETE FROM member_team 
	    WHERE team_code = #{team_code} AND member_code = #{member_code}
	</delete>


	<select id="listJoinRequest" parameterType="Long" resultType="com.fl.model.JoinRequestDTO">
	    SELECT 
	        r.member_code, 
	        r.team_code, 
	        r.status, 
	        TO_CHAR(r.created_at, 'YYYY-MM-DD') as created_at,
	        
	        m.member_name AS user_name, 
	        m.member_id AS user_id
	    FROM join_request r
	    JOIN member m ON r.member_code = m.member_code
	    WHERE r.team_code = #{team_code}
	    ORDER BY r.created_at ASC
	</select>

	<insert id="insertTeamMemberFromRequest" parameterType="com.fl.model.TeamMemberDTO">
		INSERT INTO member_team(member_code, team_code, role_level, position)
		VALUES (#{member_code}, #{team_code}, 1, #{position})
	</insert>
	
	<delete id="deleteJoinRequest" parameterType="map">
		DELETE FROM join_request 
		WHERE team_code = #{team_code} AND member_code = #{member_code}
	</delete>


	<insert id="insertSchedule" parameterType="com.fl.model.ScheduleDTO">
        INSERT INTO schedule_team (
            board_cal_code, 
            member_code, 
            team_code, 
            match_code, 
            title, 
            content, 
            start_date, 
            end_date
        ) VALUES (
            schedule_team_seq.NEXTVAL, 
            #{member_code}, 
            #{team_code}, 
            
            <choose>
                <when test="match_code != null and match_code != 0">
                    #{match_code}
                </when>
                <otherwise>
                    NULL
                </otherwise>
            </choose>,
            
            #{title}, 
            #{content}, 
            TO_DATE(#{start_date}, 'YYYY-MM-DD HH24:MI:SS'), 
            TO_DATE(#{end_date}, 'YYYY-MM-DD HH24:MI:SS')
        )
    </insert>

    <select id="listSchedule" parameterType="map" resultType="com.fl.model.ScheduleDTO">
        SELECT 
            board_cal_code, 
            member_code, 
            team_code, 
            match_code, 
            title, 
            content,
            TO_CHAR(start_date, 'YYYY-MM-DD"T"HH24:MI:SS') AS start_date,
            TO_CHAR(end_date, 'YYYY-MM-DD"T"HH24:MI:SS') AS end_date
        FROM schedule_team
        WHERE team_code = #{team_code}
          AND start_date &gt;= TO_DATE(#{start}, 'YYYY-MM-DD"T"HH24:MI:SS')
          AND end_date &lt;= TO_DATE(#{end}, 'YYYY-MM-DD"T"HH24:MI:SS')
        ORDER BY start_date ASC
    </select>
	
	<update id="updateSchedule" parameterType="com.fl.model.ScheduleDTO">
        UPDATE schedule_team
        SET title = #{title}, 
            content = #{content},
            start_date = TO_DATE(#{start_date}, 'YYYY-MM-DD HH24:MI:SS'),
            end_date = TO_DATE(#{end_date}, 'YYYY-MM-DD HH24:MI:SS')
        WHERE board_cal_code = #{board_cal_code} 
          AND team_code = #{team_code} 
          AND member_code = #{member_code} 
    </update>
	
    <delete id="deleteSchedule" parameterType="map">
        DELETE FROM schedule_team 
        WHERE board_cal_code = #{board_cal_code} 
          AND team_code = #{team_code}
    </delete>

	<insert id="insertVote" parameterType="com.fl.model.VoteDTO">
	    INSERT INTO board_vote (
	        board_vote_code, member_code, team_code, 
	        title, content, status, view_count,
	        start_date, end_date, event_date, created_at
	    ) VALUES (
	        board_vote_seq.NEXTVAL, #{memberCode}, #{teamCode}, 
	        #{title}, #{content}, 0, 0,
	        TO_DATE(#{startDate, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'), 
	        TO_DATE(#{endDate, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),
	        TO_DATE(#{eventDate, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'), 
	        SYSDATE
	    )
	</insert>

    <select id="readVote" parameterType="map" resultType="com.fl.model.VoteDTO">
        SELECT 
            v.board_vote_code AS boardVoteCode,   v.team_code AS teamCode,
            v.member_code AS memberCode,
            v.title, 
            v.content, 
            v.status, 
            v.view_count AS viewCount,
            TO_CHAR(v.start_date, 'YYYY-MM-DD HH24:MI') AS startDate,
            TO_CHAR(v.end_date, 'YYYY-MM-DD HH24:MI') AS endDate,
            TO_CHAR(v.event_date, 'YYYY-MM-DD HH24:MI') AS eventDate,
            v.created_at AS createdAt,
            m.member_name AS writerName,          NVL((SELECT status FROM member_vote 
                 WHERE board_vote_code = v.board_vote_code 
                 AND member_code = #{member_code}), 0) AS myVoteStatus,
                 
            (SELECT COUNT(*) FROM member_vote WHERE board_vote_code = v.board_vote_code AND status = 1) AS voteCount
        FROM board_vote v
        JOIN member m ON v.member_code = m.member_code
        WHERE v.board_vote_code = #{board_vote_code}
    </select>

    <delete id="deleteVote" parameterType="map">
	    DELETE FROM board_vote 
	    WHERE board_vote_code = #{board_vote_code}
	</delete>

    <select id="readMemberVoteState" parameterType="map" resultType="Integer">
        SELECT status 
        FROM member_vote
        WHERE board_vote_code = #{board_vote_code} 
          AND member_code = #{member_code}
    </select>

    <update id="insertVoteHistory" parameterType="map">
        MERGE INTO member_vote mv
        USING DUAL
        ON (mv.board_vote_code = #{board_vote_code} AND mv.member_code = #{member_code})
        WHEN MATCHED THEN
            UPDATE SET status = #{status}
        WHEN NOT MATCHED THEN
            INSERT (board_vote_code, member_code, status)
            VALUES (#{board_vote_code}, #{member_code}, #{status})
    </update>

    <select id="listVote" parameterType="map" resultType="com.fl.model.VoteDTO">
	    SELECT 
	        v.board_vote_code AS boardVoteCode,   v.title, 
            v.status,
	        TO_CHAR(v.end_date, 'YYYY-MM-DD') AS endDate,
            TO_CHAR(v.event_date, 'YYYY-MM-DD HH24:MI') AS eventDate,
	        m.member_name AS writerName,
            (SELECT COUNT(*) FROM member_vote WHERE board_vote_code = v.board_vote_code AND status = 1) AS voteCount
	    FROM board_vote v
	    JOIN member m ON v.member_code = m.member_code
	    WHERE v.team_code = #{team_code}
	    ORDER BY v.board_vote_code DESC
	</select>

	<delete id="deleteMemberVoteAll" parameterType="map">
	    DELETE FROM member_vote 
	    WHERE board_vote_code = #{board_vote_code}
	</delete>
	
	<delete id="deleteScheduleByVote" parameterType="map">
	    DELETE FROM schedule_team 
	    WHERE team_code = #{team_code} 
	      AND title = '[투표] ' || #{title}
	      AND start_date = TO_DATE(#{event_date, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS')
	</delete>
	
	<insert id="insertTeamBoard" parameterType="com.fl.model.TeamBoardDTO">
        INSERT INTO board_team(
            board_team_code, team_code, member_code, title, content, 
            created_at, category, hit_count, video_url
        )
        VALUES (
            board_team_seq.NEXTVAL, #{team_code}, #{member_code}, #{title}, #{content}, 
            SYSDATE, 0, 0, #{video_url, jdbcType=VARCHAR}
        )
    </insert>

    <select id="listTeamBoard" parameterType="map" resultType="com.fl.model.TeamBoardDTO">
        SELECT * FROM (
            SELECT ROWNUM rnum, tb.* FROM (
                SELECT b.board_team_code, b.title, 
                       b.hit_count AS view_count, TO_CHAR(b.created_at, 'YYYY-MM-DD') as created_at,
                       
                       m.member_name, 
                       m.member_id,      b.category AS notice,   (SELECT COUNT(*) FROM comment_team r WHERE r.board_team_code = b.board_team_code) AS replyCount,
                       
                       (SELECT COUNT(*) FROM file_team f WHERE f.board_team_code = b.board_team_code) AS file_count

                FROM board_team b
                JOIN member m ON b.member_code = m.member_code 
                WHERE b.team_code = #{team_code}
                
                <if test="keyword != null and keyword != ''">
                   </if>
                
                ORDER BY b.category DESC, b.board_team_code DESC
            ) tb WHERE ROWNUM &lt;= #{end}
        ) WHERE rnum &gt;= #{start}
    </select>
    
    

    <select id="dataCountTeamBoard" parameterType="map" resultType="Integer">
        SELECT NVL(COUNT(*), 0) 
        FROM board_team b
        JOIN member m ON b.member_code = m.member_code WHERE b.team_code = #{team_code}
        <if test="keyword != null and keyword != ''">
            AND (
                <choose>
                    <when test="condition == 'all'">
                        INSTR(title, #{keyword}) &gt; 0 OR INSTR(content, #{keyword}) &gt; 0
                    </when>
                    <when test="condition == 'subject' or condition == 'title'">
                        INSTR(title, #{keyword}) &gt; 0
                    </when>
                    <when test="condition == 'content'">
                        INSTR(content, #{keyword}) &gt; 0
                    </when>
                    <when test="condition == 'userName'">
                        INSTR(m.member_name, #{keyword}) &gt; 0 
                    </when>
                    <when test="condition == 'created_at'">
                        TO_CHAR(b.created_at, 'YYYY-MM-DD') = #{keyword}
                    </when>
                </choose>
            )
        </if>
    </select>

    <update id="updateHitCount" parameterType="Long">
        UPDATE board_team SET hit_count = hit_count + 1 WHERE board_team_code = #{board_team_code}
    </update>

    <select id="readTeamBoard" parameterType="long" resultType="com.fl.model.TeamBoardDTO">
        SELECT b.board_team_code, b.team_code, b.member_code, b.title, b.content, 
               b.created_at, 
               b.hit_count AS view_count,  b.video_url,           
               (SELECT COUNT(*) FROM board_team_like L WHERE L.board_team_code = b.board_team_code) AS like_count,
               m.member_name
        FROM board_team b
        JOIN member m ON b.member_code = m.member_code
        WHERE b.board_team_code = #{board_team_code}
    </select>

    <update id="updateTeamBoard" parameterType="com.fl.model.TeamBoardDTO">
        UPDATE board_team SET title = #{title}, content = #{content}
        WHERE board_team_code = #{board_team_code}
    </update>

    <delete id="deleteTeamBoard" parameterType="Long">
        DELETE FROM board_team WHERE board_team_code = #{board_team_code}
    </delete>

    <select id="preReadTeamBoard" parameterType="map" resultType="com.fl.model.TeamBoardDTO">
        SELECT board_team_code, title
        FROM board_team b
        JOIN member m ON b.member_code = m.member_code
        WHERE b.team_code = #{team_code}
          AND b.board_team_code &gt; #{board_team_code}
          
          <if test="keyword != null and keyword != ''">
              AND (
                  <if test="condition == 'all'">
                      INSTR(b.title, #{keyword}) &gt; 0 OR INSTR(b.content, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'title'">
                      INSTR(b.title, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'content'">
                      INSTR(b.content, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'userName'">
                      INSTR(m.member_name, #{keyword}) &gt; 0
                  </if>
              )
          </if>
          
        ORDER BY b.board_team_code ASC
        FETCH FIRST 1 ROWS ONLY
    </select>

    <select id="nextReadTeamBoard" parameterType="map" resultType="com.fl.model.TeamBoardDTO">
        SELECT board_team_code, title
        FROM board_team b
        JOIN member m ON b.member_code = m.member_code
        WHERE b.team_code = #{team_code}
          AND b.board_team_code &lt; #{board_team_code}
          
          <if test="keyword != null and keyword != ''">
              AND (
                  <if test="condition == 'all'">
                      INSTR(b.title, #{keyword}) &gt; 0 OR INSTR(b.content, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'title'">
                      INSTR(b.title, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'content'">
                      INSTR(b.content, #{keyword}) &gt; 0
                  </if>
                  <if test="condition == 'userName'">
                      INSTR(m.member_name, #{keyword}) &gt; 0
                  </if>
              )
          </if>
          
        ORDER BY b.board_team_code DESC
        FETCH FIRST 1 ROWS ONLY
    </select>
	
	<insert id="insertBoardReply" parameterType="com.fl.model.BoardReplyDTO">
        INSERT INTO comment_team(
            comment_id, board_team_code, member_code, content, created_at
        ) VALUES (
            comment_team_seq.NEXTVAL, #{board_team_code}, #{member_code}, #{content}, SYSDATE
        )
    </insert>

    <select id="listBoardReply" parameterType="map" resultType="com.fl.model.BoardReplyDTO">
        SELECT r.comment_id,   r.board_team_code, 
               r.member_code, 
               r.content, 
               r.created_at, 
               m.member_name   FROM comment_team r
        JOIN member m ON r.member_code = m.member_code
        WHERE r.board_team_code = #{board_team_code}
        ORDER BY r.comment_id DESC
        OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
    </select>

    <select id="dataCountBoardReply" parameterType="map" resultType="Integer">
        SELECT NVL(COUNT(*), 0)
        FROM comment_team
        WHERE board_team_code = #{board_team_code}
    </select>
	
	<update id="updateBoardReply" parameterType="map">
        UPDATE comment_team
        SET content = #{content}
        WHERE comment_id = #{comment_id} AND member_code = #{member_code}
    </update>
	
    <delete id="deleteBoardReply" parameterType="map">
        DELETE FROM comment_team
        WHERE comment_id = #{reply_code}
    </delete>

    <insert id="insertBoardLike" parameterType="map">
        INSERT INTO board_team_like(board_team_code, member_code)
        VALUES (#{board_team_code}, #{member_code})
    </insert>

    <delete id="deleteBoardLike" parameterType="map">
        DELETE FROM board_team_like
        WHERE board_team_code = #{board_team_code} AND member_code = #{member_code}
    </delete>

    <select id="countBoardLike" parameterType="Long" resultType="Integer">
        SELECT COUNT(*) 
        FROM board_team_like
        WHERE board_team_code = #{board_team_code}
    </select>

    <select id="checkBoardLike" parameterType="map" resultType="Integer">
        SELECT COUNT(*) 
        FROM board_team_like
        WHERE board_team_code = #{board_team_code} AND member_code = #{member_code}
    </select>
	
	<select id="readMemberRoleLevel" parameterType="map" resultType="Integer">
        SELECT role_level
        FROM member_team
        WHERE team_code = #{team_code} AND member_code = #{member_code}
    </select>
	
	<insert id="insertGallery" parameterType="com.fl.model.GalleryDTO">
		<selectKey keyProperty="gallery_code" resultType="Long" order="BEFORE">
			SELECT team_gallery_seq.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO team_gallery(gallery_code, team_code, member_code, title, content, title_image, view_count, created_at)
		VALUES (#{gallery_code}, #{team_code}, #{member_code}, #{title}, #{content}, #{title_image, jdbcType=VARCHAR}, 0, SYSDATE)
	</insert>

	<select id="galleryDataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*), 0) 
		FROM team_gallery 
		WHERE team_code = #{team_code}
	</select>

	<select id="listGallery" parameterType="map" resultType="com.fl.model.GalleryDTO">
		SELECT 
			g.gallery_code, 
			g.team_code, 
			g.member_code, 
			g.title, 
			g.title_image, 
			g.view_count,
			TO_CHAR(g.created_at, 'YYYY-MM-DD') AS created_at,
			m.member_name,       
			tm.profile_image,
			/* 댓글수, 좋아요수 서브쿼리 */
			(SELECT COUNT(*) FROM team_gallery_comment WHERE gallery_code = g.gallery_code) AS reply_count,
			(SELECT COUNT(*) FROM team_gallery_like WHERE gallery_code = g.gallery_code) AS like_count

		FROM team_gallery g
		JOIN member m ON g.member_code = m.member_code
		LEFT JOIN member_team tm ON g.team_code = tm.team_code AND g.member_code = tm.member_code
		
		WHERE g.team_code = #{team_code}
		ORDER BY g.gallery_code DESC
		OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
	</select>

	<select id="readGallery" parameterType="Long" resultType="com.fl.model.GalleryDTO">
		SELECT 
			g.gallery_code, g.team_code, g.member_code, 
			g.title, g.content, g.title_image, g.view_count, 
			TO_CHAR(g.created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at,
			m.member_name, m.member_id,
			tm.profile_image,
			(SELECT COUNT(*) FROM team_gallery_comment WHERE gallery_code = g.gallery_code) AS reply_count,
			(SELECT COUNT(*) FROM team_gallery_like WHERE gallery_code = g.gallery_code) AS like_count
			
		FROM team_gallery g
		JOIN member m ON g.member_code = m.member_code
		LEFT JOIN member_team tm ON g.team_code = tm.team_code AND g.member_code = tm.member_code
		WHERE g.gallery_code = #{gallery_code}
	</select>
	
	<update id="updateGalleryHitCount" parameterType="Long">
		UPDATE team_gallery SET view_count = view_count + 1 WHERE gallery_code = #{gallery_code}
	</update>

	<update id="updateGallery" parameterType="com.fl.model.GalleryDTO">
		UPDATE team_gallery
		SET title = #{title},
			content = #{content}
			<if test="title_image != null and title_image != ''">
				, title_image = #{title_image}
			</if>
		WHERE gallery_code = #{gallery_code}
	</update>

	<delete id="deleteGallery" parameterType="Long">
		DELETE FROM team_gallery WHERE gallery_code = #{gallery_code}
	</delete>


	<insert id="insertGalleryFile" parameterType="com.fl.model.FileDTO">
		INSERT INTO team_gallery_file(file_code, gallery_code, file_server_name, file_origin_name)
		VALUES (team_gallery_file_seq.NEXTVAL, #{gallery_code}, #{file_server_name}, #{file_name})
	</insert>

	<select id="listGalleryFiles" parameterType="Long" resultType="com.fl.model.FileDTO">
		SELECT 
			file_code AS file_id,
			gallery_code,
			file_server_name,
			file_origin_name AS file_name
		FROM team_gallery_file
		WHERE gallery_code = #{gallery_code}
	</select>


	<insert id="insertReply" parameterType="com.fl.model.BoardReplyDTO">
		INSERT INTO team_gallery_comment(comment_code, gallery_code, member_code, content, created_at)
		VALUES (team_gallery_comment_seq.NEXTVAL, #{gallery_code}, #{member_code}, #{content}, SYSDATE)
	</insert>

	<select id="listReply" parameterType="map" resultType="com.fl.model.BoardReplyDTO">
		SELECT 
			c.comment_code AS comment_id,  
			c.gallery_code,
			c.member_code,
			c.content,
			TO_CHAR(c.created_at, 'YYYY-MM-DD HH24:MI') AS created_at,
			m.member_name,
			tm.profile_image               
		FROM team_gallery_comment c
		JOIN member m ON c.member_code = m.member_code
		LEFT JOIN member_team tm ON m.member_code = tm.member_code AND tm.team_code = #{team_code}
		WHERE c.gallery_code = #{gallery_code}
		ORDER BY c.comment_code DESC
		OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
	</select>

	<select id="replyCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*), 0) FROM team_gallery_comment WHERE gallery_code = #{gallery_code}
	</select>

	<delete id="deleteReply" parameterType="map">
		DELETE FROM team_gallery_comment 
		WHERE comment_code = #{comment_id}
	</delete>
	
	<insert id="insertGalleryLike" parameterType="map">
		INSERT INTO team_gallery_like(gallery_code, member_code)
		VALUES (#{gallery_code}, #{member_code})
	</insert>

	<delete id="deleteGalleryLike" parameterType="map">
		DELETE FROM team_gallery_like
		WHERE gallery_code = #{gallery_code} AND member_code = #{member_code}
	</delete>

	<select id="checkGalleryLike" parameterType="map" resultType="Integer">
		SELECT COUNT(*) 
		FROM team_gallery_like
		WHERE gallery_code = #{gallery_code} AND member_code = #{member_code}
	</select>
	
	<select id="countGalleryLike" parameterType="Long" resultType="Integer">
		SELECT COUNT(*) 
		FROM team_gallery_like
		WHERE gallery_code = #{gallery_code}
	</select>
	
	<select id="listFile" parameterType="long" resultType="com.fl.model.FileDTO">
        SELECT file_id, file_name, file_server_name, file_size
        FROM file_team
        WHERE board_team_code = #{board_team_code}
    </select>
	
	<update id="updateReply" parameterType="map">
	    UPDATE team_gallery_comment 
	    SET content = #{content}
	    WHERE comment_code = #{comment_id} AND member_code = #{member_code}
	</update>
	
	<delete id="deleteGalleryFiles" parameterType="Long">
        DELETE FROM team_gallery_file WHERE gallery_code = #{gallery_code}
    </delete>
</mapper>