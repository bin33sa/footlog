<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fl.mapper.BoardQnaMapper">

	<insert id="insertQna" parameterType="com.fl.model.BoardQnaDTO">
		INSERT INTO board_qna (
		board_qna_code, member_code, title, content,
		category, status,
		created_at
		) VALUES (
		board_qna_seq.NEXTVAL, #{member_code}, #{title},
		#{content},
		#{category}, 1, SYSDATE
		)
	</insert>

	<select id="listQna" parameterType="map"
		resultType="com.fl.model.BoardQnaDTO">
		SELECT * FROM (
		SELECT ROWNUM rnum, tb.* FROM (
		SELECT q.board_qna_code,
		q.member_code, q.title,
		q.status, q.category,
		TO_CHAR(q.created_at,
		'YYYY-MM-DD') created_at,
		m.member_name, m.member_id
		FROM board_qna q
		JOIN member m ON q.member_code = m.member_code
		<where>
			<if test="kwd != null and kwd != ''">
				<choose>
					<when test="schType == 'all'">
						(INSTR(title, #{kwd}) &gt; 0 OR INSTR(content,
						#{kwd}) &gt; 0)
					</when>
					<otherwise>
						INSTR(${schType}, #{kwd}) &gt; 0
					</otherwise>
				</choose>
			</if>
			<if test="member_code != null">
				AND q.member_code = #{member_code}
			</if>
		</where>
		ORDER BY q.board_qna_code DESC
		) tb WHERE ROWNUM &lt;= #{offset} +
		#{size}
		) WHERE rnum &gt; #{offset}
	</select>

	<select id="findByCode" parameterType="long"
		resultType="com.fl.model.BoardQnaDTO">
		SELECT q.board_qna_code, q.member_code, q.title, q.content,
		q.answer, q.status, q.category, q.created_at,
		m.member_name,
		m.member_id
		FROM board_qna q
		JOIN member m ON q.member_code =
		m.member_code
		WHERE q.board_qna_code = #{board_qna_code}
	</select>


	<select id="dataCount" parameterType="map" resultType="int">
		SELECT COUNT(*)
		FROM board_qna q
		JOIN member m ON q.member_code =
		m.member_code
		<where>
			<if test="kwd != null and kwd != ''">
				<choose>
					<when test="schType == 'all'">
						(INSTR(q.title, #{kwd}) &gt; 0 OR INSTR(q.content,
						#{kwd}) &gt; 0)
					</when>
					<otherwise>
						INSTR(${schType}, #{kwd}) &gt; 0
					</otherwise>
				</choose>
			</if>
		</where>
	</select>

	<delete id="deleteQna" parameterType="long">
		DELETE FROM board_qna
		WHERE
		board_qna_code = #{board_qna_code}
	</delete>

	<update id="updateAnswer"
		parameterType="com.fl.model.BoardQnaDTO">
		UPDATE board_qna SET
		answer = #{answer, jdbcType=VARCHAR},
		status = #{status} WHERE board_qna_code = #{board_qna_code}
	</update>


</mapper>